<!DOCTYPE html>
<html lang="ru-RU">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, maximum-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="application-name" content="UR5">
    <meta name="description" content="UR5 Monitor">
    <title>UR5 Monitor v0.47 Beta</title>
    <script>
        if (typeof module === 'object') { window.module = module; module = undefined; }
    </script>
    <link rel="shortcut icon" href="./images/robot-icon-29.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.0/semantic.min.css">
    <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
    <script src="./../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.30.1/js/jquery.tablesorter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.0/semantic.min.js"></script>
    <script>if (typeof exports !== 'object') { exports = {}; }</script>
    <script src="./../bin/Tools/Logger.js"></script>
    <script src="./../bin/Tools/URMath.js"></script>
    <script src="./../bin/Front/Monitor.js"></script>
    <script>if (window.module) module = window.module;</script>
</head>

<body>
    <br>
    <div id="body_container" class="ui container">
        <div id="security_stop" class="ui icon warning message hidden">
            <i class="close icon"></i>
            <div class="content">
                <div class="header">
                    Security Stop!
                </div>
                <p></p>
            </div>
        </div>
        <div id="teach_alert" class="ui icon warning message hidden">
            <i class="close icon"></i>
            <div class="content">
                <div class="header">
                    Teach Button Pressed!
                </div>
                <p>Free movement of engines is included!</p>
            </div>
        </div>
        <h4 class="ui horizontal divider header">
            UR5 Dashboard
        </h4>
        <div class="ui three column divided grid">
            <div class="stretched row">
                <div class="column">
                    <div class="ui segment">
                        <h4 class="ui horizontal divider header">
                            Status
                        </h4>
                        <table class="ui very basic collapsing celled table">
                            <thead></thead>
                            <tbody>
                                <tr>
                                    <td>
                                        Voltage
                                    </td>
                                    <td>
                                        <div id="Voltage" class="ui label">
                                            0.0 V
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Power
                                    </td>
                                    <td>
                                        <div id="power" class="ui red horizontal label">Off</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Program
                                    </td>
                                    <td>
                                        <div id="prog_playing" class="ui red horizontal label">NONE</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Temperature
                                    </td>
                                    <td>
                                        <div id="master_temp" class="ui label">
                                            0.0
                                            <div class="detail">&deg;C</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <h4 class="ui horizontal divider header">
                            Mode
                        </h4>
                        <br>
                        <div class="ui two column centered grid">
                            <div id="robotMode" class="ui red horizontal label large">NOT_CONNECTED</div>
                        </div>
                        <br>
                        <div class="ui divider"></div>
                    </div>
                </div>
                <!--
                                <tr>
                                    <td>
                                        Motor Mode
                                    </td>
                                    <td>
                                        <div id="motorMode" class="ui red horizontal label large">NOT_RESPONDING (6)</div>
                                    </td>
                                </tr>-->
                <div class="column">
                    <div class="ui segment">
                        <h4 class="ui horizontal divider header">
                            Joint Position
                        </h4>
                        <a id="joint_base" pop data-content="Joint Base" class="ui circular label">
                            0 &deg;
                        </a>
                        <a id="joint_shoulder" pop data-content="Joint Shoulder" class="ui circular label">
                            0 &deg;
                        </a>
                        <a id="joint_elbow" pop data-content="Joint Elbow" class="ui circular label">
                            0 &deg;
                        </a>
                        <div class="ui divider"></div>
                        <a id="joint_wrist1" pop data-content="Joint Wrist 1" class="ui circular label">
                            0 &deg;
                        </a>
                        <a id="joint_wrist2" pop data-content="Joint Wrist 2" class="ui circular label">
                            0 &deg;
                        </a>
                        <a id="joint_wrist3" pop data-content="Joint Wrist 3" class="ui circular label">
                            0 &deg;
                        </a>
                    </div>
                    <div class="ui segment">
                        <h4 class="ui horizontal divider header">
                            Amperage
                        </h4>
                        <table class="ui very basic collapsing celled table">
                            <thead></thead>
                            <tbody>
                                <tr>
                                    <td>
                                        Robot Current
                                    </td>
                                    <td>
                                        <div id="current_amper" class="ui label">
                                            0.0 mA
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        IO Current
                                    </td>
                                    <td>
                                        <div id="io_current_amper" class="ui label">
                                            0.0 mA
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Tool Current
                                    </td>
                                    <td>
                                        <div id="tool_current_amper" class="ui label">
                                            0.0 mA
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="column">
                    <div class="ui segment">
                        <h4 class="ui horizontal divider header">
                            Tool Position
                        </h4>
                        <div class="ui circular labels">
                            <a id="tool_p_x" pop data-content="X" class="ui label">
                                0 &deg;
                            </a>
                            <a id="tool_p_y" pop data-content="Y" class="ui label">
                                0 &deg;
                            </a>
                            <a id="tool_p_z" pop data-content="Z" class="ui label">
                                0 &deg;
                            </a>
                        </div>
                    </div>
                    <div class="ui segment">
                        <h4 class="ui horizontal divider header">
                            Tool Orientation
                        </h4>
                        <div class="ui circular labels">
                            <a id="tool_o_x" pop data-content="X" class="ui label">
                                0 &deg;
                            </a>
                            <a id="tool_o_y" pop data-content="Y" class="ui label">
                                0 &deg;
                            </a>
                            <a id="tool_o_z" pop data-content="Z" class="ui label">
                                0 &deg;
                            </a>
                        </div>
                    </div>
                    <div class="ui segment">
                        <h4 class="ui horizontal divider header">
                            Manage
                        </h4>
                        <a id="teach_btn" href="javascript:TeachButtonPress();" pop data-content="Freedrive" class="ui icon button">
                            <i class="wheelchair icon"></i>
                        </a>
                        <a id="power_btn" href="javascript:PowerOn()" pop data-content="Power" class="ui blue icon button">
                            <i class="power icon"></i>
                        </a>
                        <a href="javascript:ProgramRun()" pop data-content="Run program" class="ui yellow icon button">
                            <i class="assistive listening systems icon"></i>
                        </a>
                    </div>
                </div>
            </div>

        </div>
        <h4 class="ui horizontal divider header">
            <i class="ellipsis horizontal icon"></i>
        </h4>
        <br>
    </div>

</body>


<script>
    $('[pop]').popup();
    const { ipcRenderer } = require('electron')
    UR5Render.BindShortcut();
    UR5Render.On(ipcRenderer);

    function TeachButtonPress() {
        ipcRenderer.send("ur-delegate", { opcode: 29, action: "teach" })
    }
    function PowerOn() {
        ipcRenderer.send("ur-delegate", { opcode: 29, action: "brake-release" })
    }
    function ProgramRun() {
        ipcRenderer.send("ur-delegate", { opcode: 29, action: "start_program" })
    }
    ipcRenderer.on("ur-delegate", (event, arg) => {
        if (arg.opcode !== 31) {
            console.log("err: invalid opcode");
            return;
        }
        let isEnable = arg.IsEnable;
        if (isEnable) {
            $("#teach_btn").addClass("green").removeClass("red");
        } else {
            $("#teach_btn").addClass("red").removeClass("green");
        }
    });

    ipcRenderer.on("ur5", (event, arg) => {
        let info = arg.data;
        console.log(info);
        $("#Voltage").text(`${(+URMath.Round(info.robotVoltage48V, 2)).toFixed(1)} V`);
        $("#master_temp").html(`${(+URMath.Round(info.masterTemperature, 2)).toFixed(1)}  <div class="detail">&deg;C</div>`);

        $("#current_amper").text(`${(+URMath.Round(info.robotCurrent, 2)).toFixed(2)} A`);
        $("#io_current_amper").text(`${+URMath.Round(info.masterIOCurrent * 1000, 1)} mA`);
        $("#tool_current_amper").text(`${+URMath.Round(info.toolCurrent * 1000, 1)} mA`);

        $("#joint_base").html(`${info.sector[0].DegreePosition} &deg;`);
        $("#joint_shoulder").html(`${info.sector[1].DegreePosition} &deg;`);
        $("#joint_elbow").html(`${info.sector[2].DegreePosition} &deg;`);

        $("#joint_wrist1").html(`${info.sector[3].DegreePosition} &deg;`);
        $("#joint_wrist2").html(`${info.sector[4].DegreePosition} &deg;`);
        $("#joint_wrist3").html(`${info.sector[5].DegreePosition} &deg;`);


        switch (info.robotMode) {
            case "RUNNING":
                $("#teach_btn").addClass("red").removeClass("green");
                $("#robotMode").text("OK").removeClass("red").removeClass("yellow").addClass("green");
                break;
            case "FREEDRIVE":
                $("#teach_btn").addClass("green").removeClass("red");
                $("#robotMode").text("FREEDRIVE").removeClass("red").removeClass("green").addClass("yellow");
                break;
            case "EMERGENCY_STOPPED":
                $("#teach_btn").addClass("red").removeClass("green");
                $("#robotMode").text("EMERGENCY STOPPED").removeClass("yellow").removeClass("green").addClass("red");
                break;
            case "INITIALIZING":
                $("#teach_btn").addClass("red").removeClass("green");
                $("#robotMode").text("INITIALIZING").removeClass("red").removeClass("green").addClass("yellow");
                break;
            default:
                $("#teach_btn").addClass("red").removeClass("green");
                $("#robotMode").text(`${info.robotMode}`.replace("_", " ")).removeClass("yellow").removeClass("green").addClass("red");
                break;
        }
        switch (info.robotMode) {
            case "NO_POWER":
                $("#power_btn").removeClass("disabled");
                break;
            default:
                $("#power_btn").addClass("disabled");
                break;
        }

        if (info.robotPowerOn) {
            $("#power").removeClass("red").addClass("green").text("ON");
        }
        else {
            $("#power").removeClass("green").addClass("red").text("OFF");
        }
        if (info.programRunning) {
            $("#prog_playing").text("WORK").removeClass("red").removeClass("yellow").addClass("green");
        } else if (info.programPaused) {
            $("#prog_playing").text("PAUSE").removeClass("red").removeClass("green").addClass("yellow");
        } else {
            $("#prog_playing").text("NONE").removeClass("yellow").removeClass("green").addClass("red");
        }


        $("#tool_p_x").html(`${(+URMath.Round(info.ToolPosition.X * 39.3701, 2)).toFixed(2)} in`)
        $("#tool_p_y").html(`${(+URMath.Round(info.ToolPosition.Y * 39.3701, 2)).toFixed(2)} in`)
        $("#tool_p_z").html(`${(+URMath.Round(info.ToolPosition.Z * 39.3701, 2)).toFixed(2)} in`)

        $("#tool_o_x").html(`${(+URMath.Round(info.ToolOrientation.X * 180 / Math.PI, 2)).toFixed(2)} &deg;`)
        $("#tool_o_y").html(`${(+URMath.Round(info.ToolOrientation.Y * 180 / Math.PI, 2)).toFixed(2)} &deg;`)
        $("#tool_o_z").html(`${(+URMath.Round(info.ToolOrientation.Z * 180 / Math.PI, 2)).toFixed(2)} &deg;`)

    });
</script>

</html>