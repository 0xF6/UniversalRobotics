<!DOCTYPE html>
<html lang="ru-RU">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, maximum-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="application-name" content="UR5">
    <meta name="description" content="UR5 Monitor">
    <title>UR5 Monitor</title>
    <script>
        if (typeof module === 'object') { window.module = module; module = undefined; }
    </script>
    <link rel="shortcut icon" href="./images/robot-icon-29.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.0/semantic.min.css">
    <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
    <script src="./../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.30.1/js/jquery.tablesorter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.0/semantic.min.js"></script>
    <script>if (typeof exports !== 'object') { exports = {}; }</script>
    <script src="./../bin/Tools/Logger.js"></script>
    <script src="./../bin/Tools/URMath.js"></script>
    <script src="./../bin/Front/Monitor.js"></script>
    <script>if (window.module) module = window.module;</script>
</head>

<body>
    <br>
    <div id="body_container" class="ui container">
        <div id="security_stop" class="ui icon warning message hidden">
            <i class="close icon"></i>
            <div class="content">
                <div class="header">
                    Security Stop!
                </div>
                <p></p>
            </div>
        </div>
        <div id="teach_alert" class="ui icon warning message hidden">
            <i class="close icon"></i>
            <div class="content">
                <div class="header">
                    Teach Button Pressed!
                </div>
                <p>Free movement of engines is included!</p>
            </div>
        </div>
        <h4 class="ui horizontal divider header">
            <i class="tag icon"></i>
            Monitor
        </h4>
        <div class="ui three column divided grid">
            <div class="stretched row">
                <div class="column">
                    <div class="ui segment">
                        <table class="ui very basic collapsing celled table">
                            <thead></thead>
                            <tbody>
                                <tr>
                                    <td>
                                        Voltage
                                    </td>
                                    <td>
                                        <div id="Voltage" class="ui label">
                                            0.0 V
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Power
                                    </td>
                                    <td>
                                        <div id="power" class="ui red horizontal label">Off</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Program
                                    </td>
                                    <td>
                                        <div id="prog_playing" class="ui red horizontal label">NONE</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Temperature
                                    </td>
                                    <td>
                                        <div id="master_temp" class="ui label">
                                            0.0
                                            <div class="detail">&deg;C</div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Mode
                                    </td>
                                    <td>
                                        <div id="robotMode" class="ui red horizontal label">NOT_CONNECTED</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="column">
                    <div class="ui segment">
                        1
                    </div>
                    <div class="ui segment">
                        2
                    </div>
                </div>
                <div class="column">
                    <div class="ui segment">
                        <h4>Tool Position</h4>
                        <div class="ui circular labels">
                            <a id="tool_p_x" class="ui label">
                                0 &deg;
                            </a>
                            <a id="tool_p_y" class="ui label">
                                0 &deg;
                            </a>
                            <a id="tool_p_z" class="ui label">
                                0 &deg;
                            </a>
                        </div>
                    </div>
                    <div class="ui segment">
                        <h4>Tool Orientation</h4>
                        <div class="ui circular labels">
                            <a id="tool_o_x" class="ui label">
                                0 &deg;
                            </a>
                            <a id="tool_o_y" class="ui label">
                                0 &deg;
                            </a>
                            <a id="tool_o_z" class="ui label">
                                0 &deg;
                            </a>
                        </div>
                    </div>
                    <div class="ui segment">
                        <a id="teach_btn" href="javascript:TeachButtonPress();" class="ui icon button">
                            <i class="wheelchair icon"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <h4 style="position: fixed; bottom: 0;" class="ui horizontal divider header">
            <i class="ellipsis horizontal icon"></i>
        </h4>
        <br>
    </div>

</body>


<script>
    const { ipcRenderer } = require('electron')
    UR5Render.BindShortcut();
    UR5Render.On(ipcRenderer);

    function TeachButtonPress() {
        ipcRenderer.send("ur-delegate", { opcode: 29, action: "teach" })
    }
    ipcRenderer.on("ur-delegate", (event, arg) => {
        if (arg.opcode !== 31) {
            console.log("err: invalid opcode");
            return;
        }
        let isEnable = arg.IsEnable;
        if (isEnable) {
            $("#teach_btn").addClass("green").removeClass("red");
        } else {
            $("#teach_btn").addClass("red").removeClass("green");
        }
    });

    ipcRenderer.on("ur5", (event, arg) => {
        let info = arg.data;
        console.log(info);
        $("#Voltage").text(`${(+URMath.Round(info.robotVoltage48V, 2)).toFixed(1)} V`);
        $("#master_temp").html(`${(+URMath.Round(info.masterTemperature, 2)).toFixed(1)}  <div class="detail">&deg;C</div>`);
        switch (info.robotMode) {
            case "RUNNING":
                $("#teach_btn").addClass("red").removeClass("green");
                $("#robotMode").text("OK").removeClass("red").removeClass("yellow").addClass("green");
                break;
            case "FREEDRIVE":
                $("#teach_btn").addClass("green").removeClass("red");
                $("#robotMode").text("FREEDRIVE").removeClass("red").removeClass("green").addClass("yellow");
                break;
            default:
                $("#teach_btn").addClass("red").removeClass("green");
                $("#robotMode").text(info.robotMode).removeClass("yellow").removeClass("green").addClass("red");
                break;
        }

        if (info.robotPowerOn) {
            $("#power").removeClass("red").addClass("green").text("ON");
        }
        else {
            $("#power").removeClass("green").addClass("red").text("OFF");
        }

        if (info.securityStopped) {
            $("#security_stop").removeClass("hidden");
        } else {
            $("#security_stop").addClass("hidden");
        }

        if (info.programRunning) {
            $("#prog_playing").text("WORK").removeClass("red").removeClass("yellow").addClass("green");
        } else if (info.programPaused) {
            $("#prog_playing").text("PAUSE").removeClass("red").removeClass("green").addClass("yellow");
        } else {
            $("#prog_playing").text("NONE").removeClass("yellow").removeClass("green").addClass("red");
        }


        $("#tool_p_x").html(`${(+URMath.Round(info.ToolPosition.X * 39.3701, 2)).toFixed(2)} &deg;`)
        $("#tool_p_y").html(`${(+URMath.Round(info.ToolPosition.Y * 39.3701, 2)).toFixed(2)} &deg;`)
        $("#tool_p_z").html(`${(+URMath.Round(info.ToolPosition.Z * 39.3701, 2)).toFixed(2)} &deg;`)

        $("#tool_o_x").html(`${(+URMath.Round(info.ToolOrientation.X * 180 / Math.PI, 2)).toFixed(2)} &deg;`)
        $("#tool_o_y").html(`${(+URMath.Round(info.ToolOrientation.Y * 180 / Math.PI, 2)).toFixed(2)} &deg;`)
        $("#tool_o_z").html(`${(+URMath.Round(info.ToolOrientation.Z * 180 / Math.PI, 2)).toFixed(2)} &deg;`)

    });
</script>

</html>